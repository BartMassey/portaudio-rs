language: python
python:
    - 2.7

env:
    - RUST_VERSION=beta
    - RUST_VERSION=nightly

notifications:
    email:
        recipients:
            - ci@mathijs.vd-nes.nl
        on_success: never
        on_failure: always

before_install:
    - shippable_retry sudo apt-get update
    - shippable_retry curl -o ~/rustup.sh https://static.rust-lang.org/rustup.sh

install:
    - sh ~/rustup.sh --spec=$RUST_VERSION -y 2> /dev/null
    - shippable_retry sudo apt-get -y install portaudio19-dev

before_script:
    - rustc --version
    - cargo --version

script:
    - cargo build
    - cargo test
    - cargo doc --no-deps
    - "rustdoc --test README.md -L target/debug -L target/debug/deps $(pkg-config --libs-only-L portaudio-2.0 | sed 's/-L/-Lnative=/')"

after_success:
    - curl https://mvdnes.github.io/rust-docs/shippable-doc-upload.sh | sh
